//
//  LightningTests
//
//  Created by Otto Suess on 09.07.18.
//  Copyright © 2018 Zap. All rights reserved.
//

@testable import Lightning
import SwiftBTC
import XCTest

class Bolt11Tests: XCTestCase {
    // swiftlint:disable force_unwrapping
    // swiftlint:disable:next function_body_length
    func testBolt11Decoding() {
        let paymentHash = Data([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1, 2])

        let data: [(String, Bolt11.Invoice)] = [
            ("lnbc1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdpl2pkx2ctnv5sxxmmwwd5kgetjypeh2ursdae8g6twvus8g6rfwvs8qun0dfjkxaq8rkx3yf5tcsyz3d73gafnh3cax9rn449d9p5uxz9ezhhypd0elx87sjle52x86fux2ypatgddc6k63n7erqz25le42c4u4ecky03ylcqca784w",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: nil,
                description: "Please consider supporting this project",
                expiry: nil,
                fallbackAddress: nil)
            ),
            ("lnbc2500u1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdq5xysxxatsyp3k7enxv4jsxqzpuaztrnwngzn3kdzw5hydlzf03qdgm2hdq27cqv3agm2awhz5se903vruatfhq77w3ls4evs3ch9zw97j25emudupq63nyw24cg27h2rspfj9srp",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 250000,
                description: "1 cup coffee",
                expiry: 60,
                fallbackAddress: nil)
            ),
            ("lnbc2500u1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdpquwpc4curk03c9wlrswe78q4eyqc7d8d0xqzpuyk0sg5g70me25alkluzd2x62aysf2pyy8edtjeevuv4p2d5p76r4zkmneet7uvyakky2zr4cusd45tftc9c5fh0nnqpnl2jfll544esqchsrny",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 250000,
                description: "ナンセンス 1杯",
                expiry: 60,
                fallbackAddress: nil)
            ),
            ("lnbc20m1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqhp58yjmdan79s6qqdhdzgynm4zwqd5d7xmw5fk98klysy043l2ahrqscc6gd6ql3jrc5yzme8v4ntcewwz5cnw92tz0pc8qcuufvq7khhr8wpald05e92xw006sq94mg8v2ndf4sefvf9sygkshp5zfem29trqq2yxxz7",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 2000000,
                description: nil,
                expiry: nil,
                fallbackAddress: nil)
            ),
            ("lntb20m1pvjluezhp58yjmdan79s6qqdhdzgynm4zwqd5d7xmw5fk98klysy043l2ahrqspp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqfpp3x9et2e20v6pu37c5d9vax37wxq72un98kmzzhznpurw9sgl2v0nklu2g4d0keph5t7tj9tcqd8rexnd07ux4uv2cjvcqwaxgj7v4uwn5wmypjd5n69z2xm3xgksg28nwht7f6zspwp3f9t",
             Bolt11.Invoice(
                network: .testnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 2000000,
                description: nil,
                expiry: nil,
                fallbackAddress: BitcoinAddress(string: "mk2QpYatsKicvFVuTAQLBryyccRXMUaGHP")!)
            ),
            ("lnbc20m1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqhp58yjmdan79s6qqdhdzgynm4zwqd5d7xmw5fk98klysy043l2ahrqsfpp3qjmp7lwpagxun9pygexvgpjdc4jdj85fr9yq20q82gphp2nflc7jtzrcazrra7wwgzxqc8u7754cdlpfrmccae92qgzqvzq2ps8pqqqqqqpqqqqq9qqqvpeuqafqxu92d8lr6fvg0r5gv0heeeqgcrqlnm6jhphu9y00rrhy4grqszsvpcgpy9qqqqqqgqqqqq7qqzqj9n4evl6mr5aj9f58zp6fyjzup6ywn3x6sk8akg5v4tgn2q8g4fhx05wf6juaxu9760yp46454gpg5mtzgerlzezqcqvjnhjh8z3g2qqdhhwkj",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 2000000,
                description: nil,
                expiry: nil,
                fallbackAddress: BitcoinAddress(string: "1RustyRX2oai4EYYDpQGWvEL62BBGqN9T")!)
            ),
            ("lnbc20m1pvjluezhp58yjmdan79s6qqdhdzgynm4zwqd5d7xmw5fk98klysy043l2ahrqspp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqfppj3a24vwu6r8ejrss3axul8rxldph2q7z9kmrgvr7xlaqm47apw3d48zm203kzcq357a4ls9al2ea73r8jcceyjtya6fu5wzzpe50zrge6ulk4nvjcpxlekvmxl6qcs9j3tz0469gq5g658y",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 2000000,
                description: nil,
                expiry: nil,
                fallbackAddress: BitcoinAddress(string: "3EktnHQD7RiAE6uzMj2ZifT9YgRrkSgzQX")!)
            ),
            ("lnbc20m1pvjluezhp58yjmdan79s6qqdhdzgynm4zwqd5d7xmw5fk98klysy043l2ahrqspp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqfppqw508d6qejxtdg4y5r3zarvary0c5xw7kepvrhrm9s57hejg0p662ur5j5cr03890fa7k2pypgttmh4897d3raaq85a293e9jpuqwl0rnfuwzam7yr8e690nd2ypcq9hlkdwdvycqa0qza8",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 2000000,
                description: nil,
                expiry: nil,
                fallbackAddress: BitcoinAddress(string: "bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4")!)
            ),
            ("lnbc20m1pvjluezhp58yjmdan79s6qqdhdzgynm4zwqd5d7xmw5fk98klysy043l2ahrqspp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqfp4qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3q28j0v3rwgy9pvjnd48ee2pl8xrpxysd5g44td63g6xcjcu003j3qe8878hluqlvl3km8rm92f5stamd3jw763n3hck0ct7p8wwj463cql26ava",
             Bolt11.Invoice(
                network: .mainnet,
                date: Date(timeIntervalSince1970: 1496314658),
                paymentHash: paymentHash,
                amount: 2000000,
                description: nil,
                expiry: nil,
                fallbackAddress: BitcoinAddress(string: "bc1qrp33g0q5c5txsp9arysrx4k6zdkfs4nce4xj0gdcccefvpysxf3qccfmv3")!)
            )
        ]

        for (input, output) in data {
            let decoded = Bolt11().decode(string: input)
            XCTAssertEqual(decoded, output)
        }
    }
}
